---
title: "Everyday statistics in 30 minutes"
author: "Peter Geelan-Small - Stats Central, UNSW"
date: "29th July, 2021"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    lib_dir: libs
    self_contained: false
    nature:
      highlightStyle: github
      countIncrementalSlides: false
      beforeInit: "macros.js"
---



```{r setup, include = F}

knitr::opts_chunk$set(echo = F, fig.align = "center", 
                      fig.asp = 1,
                      echo = F, message = F, warning = F)

```




```{r xaringan-logo, echo = F}

library(xaringanExtra)

use_logo(
  image_url = "StatsCentralLogo_rmd.png",
  width = "110px",
  height = "128px",
  position = css_position(bottom = "-2.5em", left = "1em"),
  link_url = NULL,
  exclude_class = c("title-slide", "inverse", "hide_logo")
)

```




```{r echo = F, message = F}

library(RColorBrewer)
library(wordcloud)
library(tidyverse)
library(ggpubr)
library(faraway)  ## For "sumary"
library(GGally)
library(plotly)
library(reshape2)  ## For "acast"
library(png)
library(kableExtra)
library(emmeans)

```


<style type="text/css">
.remark-slide-content {
  font-size: 28px;
  padding: 1em 1em 1em 1em;
}
</style>



# Background

Statistics in research

- May need statistics to get *information* from your data
- Information includes some indication of how system fits together and associated uncertainty
- Start with good design - fancy statistics can't usually fix holes in design
- At start of study, need a statistical plan of how to analyse results
- To consult the statistician after an experiment is finished is often merely to ask [them] to conduct a post mortem examination. [They] can perhaps say what the experiment died of. (Ronald Fisher, 1938. *Sankhya* 4: 14-17)

---

# Statistical plan

- Research question $\;\rightarrow\;$ objectives/hypotheses
- Objectives/hypotheses framed in terms of 
    - specific *outcome* and 
    - possible explanatory or predictor variables associated with that outcome
    
How do you know what statistical analysis methods to use?
- Depends on:
    - study design - independent data or not
    - type of outcome variable - continuous, binary, count


---

# Models - are there really so many?


- 1820s - linear regression based on normal distribution
- Early 1900s - Pearson's $\chi^2$ (chi-squared) test
- 1908 - $t$ test
- 1920s or so - analysis of variance (ANOVA) and analysis of covariance (ANCOVA)
- 1972 - generalised linear models - models based on normal, binomial, Poisson and other distributions unified


---
 
# Models - are there really so many?

Model names are an accident of history


```{r}

#words_df <- read.csv("../data/stats_tests.csv", header = F)

words_df <- read.csv("../data/stats_tests.csv", header = F)

wordcloud(words = words_df[ , 1], freq = words_df[ , 2],
          colors = brewer.pal(6, "Dark2"),
          random.color = T,
          scale = c(3, 1), rot.per = 1/4)

```



---

# Linear model: linear regression

```{r}

## Load data

load("../data/harris_data_obj.RData")

load("../data/kinoshita_data_obj.RData")

```


Harris (2017): Surgical instrument proficiency

Proficiency in instrument control: Is smooth instrument movement related to error rate in a ring-carrying exercise?

*Outcome:* No. errors per sec. (baseline) - continuous

*Predictor:* Mean jerk (change in acceleration) - continuous

*Data:* independent

*Model:* linear regression

$$\mathrm{ErrorRate} = \beta_0 + \beta_1 \; \mathrm{MeanJerk}$$

---

# Linear model: linear regression


```{r}

p_surg_err <- 
  ggplot(surg, aes(x = "", y = ERRORS.SEC_RT1)) +
  geom_boxplot(outlier.shape = NA, width = 0.4) +  # avoid plotting outliers twice
  geom_jitter(position = position_jitter(width = 0.1, height = 0.1)) +
  labs(x = "", y = "Error per sec.") +
  theme_classic()


p_surg_jerk <- 
  ggplot(surg, aes(x = "", y = MeanJerk1)) +
  geom_boxplot(outlier.shape = NA, width = 0.4) +  # avoid plotting outliers twice
  geom_jitter(position = position_jitter(width = 0.1, height = 0.1)) +
  labs("", y = "Mean jerk (m/s^3)") +
  theme_classic()


ggarrange(p_surg_err, p_surg_jerk, ncol = 2)

```


---

# Linear model: linear regression


```{r}

p_surg_err_jerk <- 
  ggplot(surg_sub1, aes(x = MeanJerk1, y = ERRORS.SEC_RT1)) +
  geom_point() +
  labs(x = "Mean jerk (m/s^3)", y = "Errors per sec.") +
  theme_classic()

print(p_surg_err_jerk)

```

---

# Linear model: linear regression


```{r}

err.lm1 <- lm(ERRORS.SEC_RT1 ~ MeanJerk1, data = surg_sub1)

#anova(err.lm1)

sumary(err.lm1)

```

*Assumptions*

- normal distribution of residuals
- constant variance of residuals


---

# Linear model: linear regression

Assumptions

```{r}

res_fit_err1_df <- data.frame(sres = rstandard(err.lm1),
                           fit = fitted(err.lm1))

p_res_fit_err1 <- 
  ggplot(res_fit_err1_df, aes(x = fit, y = sres)) +
  geom_point() +
  labs(x = "Fitted values", y = "Standardised residuals") +
  theme_classic()

p_qq_err1 <- 
  ggplot(res_fit_err1_df, aes(sample = sres)) +
  geom_qq() +
  geom_qq_line() +
  labs(x = "Normal quantile", y = "Sample quantile") +
  theme_classic()

ggarrange(p_res_fit_err1, p_qq_err1)

```

---



Errors/sec - *plot data*

Continuous outcome

- independent data

- continuous predictor - mean jerk - normal distribn - simple linear regression
    - assumptions  $\;\rightarrow\;$ transformation

But, it's really a rate

- count per unit time - Poisson - GLM
    - assumptions

---

# Outline

Knot-tying time - *plot data*

Continuous outcome

- independent data

- categorical predictor - two groups - gender - t test
    - assumptions
    
---

# Outline
 
Knot-tying time - *plot data*

Continuous outcome

- independent data

- categorical predictor - three groups - condition - ANOVA
    - assumptions
    - multiple comparisons - compare all to control


---

# Outline

Continuous outcome - normal distribn

Mean jerk - *plot data*

Compare baseline to post-observation

Data not independent

Mean jerk - *plot data*

- categorical predictor - two times - paired t test
    - assumptions


---

# Outline

Continuous outcome - normal distribn

Mean jerk - *plot data*

Compare baseline to post-observation to retention

Data not independent

Mean jerk - *plot data*

- categorical predictor - three times - mixed model
    - assumptions

---

# Outline

Categorical outcome

Independent data

Knot-tying skill (sat or unsat) - - *plot data*

Is there an association with condition?

Pearson's $\chi^2$ test
- assumptions

---

# Outline

Kinoshita

POD

Binary outcome

Is there an association between NLR </>= 3 ad POD?

Pearson's $\chi^2$ test
- assumptions

Can't estimate parameter or use controlling variables


---

# Outline

Kinoshita

POD

Binary outcome

- categorical predictor - NLR
- controlling variable - ACCI


---

# Outline


ICDSC score - 1, 2, ... , 6

"Quantitative" outcome - or is it?

Predictor - NLR - continuous or categorical (by interval)?

Normal assumption untenable

- non-parametric method - Kruskal-Wallis
    - compare NLR levels against lowest (Dunn's test)
    
- ordered categorical variable - ordinal logistic regression
    - NLR categories
    - NLR continuous
    
    
  
---

# References




